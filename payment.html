<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment - AuctionSphere</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <h1>ðŸŒŠ AuctionSphere</h1>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="auction.html">Auctions</a></li>
                <li><a href="#" id="logoutBtn">Logout</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <div class="payment-container">
            <div class="payment-details">
                <h2 style="text-align: center; color: var(--success-color); margin-bottom: 1.5rem;">
                    ðŸŽ‰ Congratulations! You Won the Auction!
                </h2>

                <div id="productDetails">
                    <h3 style="margin-bottom: 1rem;">Product Details</h3>
                    <div class="detail-row">
                        <span class="detail-label">Product Name:</span>
                        <span class="detail-value" id="productName"></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Final Bid Amount:</span>
                        <span class="detail-value" id="finalAmount" style="color: var(--primary-color); font-weight: 700; font-size: 1.2rem;"></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Seller:</span>
                        <span class="detail-value" id="sellerName"></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Seller UPI ID:</span>
                        <span class="detail-value" id="sellerUPI" style="font-weight: 600; color: var(--primary-color);"></span>
                    </div>
                </div>

                <div style="margin-top: 2rem;">
                    <h3 style="margin-bottom: 1rem;">Your Payment Details</h3>
                    <div class="detail-row">
                        <span class="detail-label">Your Name:</span>
                        <span class="detail-value" id="buyerName"></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Bank Account:</span>
                        <span class="detail-value" id="buyerBank"></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">IFSC Code:</span>
                        <span class="detail-value" id="buyerIFSC"></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Bank Name:</span>
                        <span class="detail-value" id="buyerBankName"></span>
                    </div>
                </div>
            </div>

            <div class="form-container">
                <h2>Complete Payment (Simulation)</h2>
                <p style="text-align: center; color: var(--text-light); margin-bottom: 1.5rem;">
                    This is a simulated payment for demonstration purposes only
                </p>

                <form id="paymentForm">
                    <div class="form-group">
                        <label for="paymentMethod">Payment Method</label>
                        <select id="paymentMethod" required>
                            <option value="upi">UPI</option>
                            <option value="netbanking">Net Banking</option>
                            <option value="card">Credit/Debit Card</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="confirmAmount">Confirm Amount (â‚¹)</label>
                        <input type="number" id="confirmAmount" readonly>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="termsCheck" required>
                            I confirm the payment details and agree to complete this transaction
                        </label>
                    </div>

                    <button type="submit" class="btn btn-success" style="width: 100%;">
                        Confirm Payment
                    </button>
                </form>
            </div>

            <div id="successMessage" style="display: none;">
                <div class="payment-details">
                    <h2 style="text-align: center; color: var(--success-color); margin-bottom: 1rem;">
                        âœ… Payment Successful!
                    </h2>
                    <p style="text-align: center; font-size: 1.1rem; margin-bottom: 1.5rem;">
                        Your payment has been processed successfully.
                    </p>
                    <div style="background: #d1fae5; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;">
                        <p style="text-align: center; color: #065f46; margin-bottom: 0.5rem;">
                            <strong>Transaction ID:</strong> <span id="transactionId"></span>
                        </p>
                        <p style="text-align: center; color: #065f46; margin: 0;">
                            <strong>Date:</strong> <span id="transactionDate"></span>
                        </p>
                    </div>
                    <p style="text-align: center; color: var(--text-light);">
                        The seller will contact you shortly for delivery arrangements.
                    </p>
                    <div style="text-align: center; margin-top: 2rem;">
                        <a href="auction.html" class="btn btn-primary">Browse More Auctions</a>
                        <a href="index.html" class="btn btn-secondary" style="margin-left: 1rem;">Go Home</a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <p>&copy; 2025 AuctionSphere - Windsurf Auction System. All rights reserved.</p>
    </footer>

    <script src="script.js"></script>
    <script>
        // Check authentication
        if (!checkAuth('buyer')) {
            throw new Error('Unauthorized');
        }

        const currentUser = getCurrentUser();
        
        // Get product ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('product');

        if (!productId) {
            showAlert('Invalid payment link', 'danger');
            setTimeout(() => {
                window.location.href = 'auction.html';
            }, 2000);
        }

        // Load product and payment details
        function loadPaymentDetails() {
            const products = JSON.parse(localStorage.getItem('products') || '[]');
            const product = products.find(p => p.id === productId);

            if (!product) {
                showAlert('Product not found', 'danger');
                setTimeout(() => {
                    window.location.href = 'auction.html';
                }, 2000);
                return;
            }

            // Display product details
            document.getElementById('productName').textContent = product.name;
            document.getElementById('finalAmount').textContent = formatCurrency(product.currentBid);
            document.getElementById('sellerName').textContent = product.sellerName;
            document.getElementById('sellerUPI').textContent = product.sellerUPI || 'Not provided';

            // Display buyer details
            document.getElementById('buyerName').textContent = currentUser.name;
            document.getElementById('buyerBank').textContent = currentUser.bankAccount || 'Not provided';
            document.getElementById('buyerIFSC').textContent = currentUser.ifscCode || 'Not provided';
            document.getElementById('buyerBankName').textContent = currentUser.bankName || 'Not provided';

            // Set confirm amount
            document.getElementById('confirmAmount').value = product.currentBid;
        }

        // Payment form submission
        document.getElementById('paymentForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const paymentMethod = document.getElementById('paymentMethod').value;
            const termsChecked = document.getElementById('termsCheck').checked;

            if (!termsChecked) {
                showAlert('Please accept the terms to continue', 'warning');
                return;
            }

            // Simulate payment processing
            const transactionId = 'TXN' + generateId().toUpperCase();
            const transactionDate = formatDateTime(Date.now());

            // Save transaction
            const transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
            transactions.push({
                id: transactionId,
                productId: productId,
                buyerId: currentUser.id,
                paymentMethod: paymentMethod,
                timestamp: Date.now()
            });
            localStorage.setItem('transactions', JSON.stringify(transactions));

            // Show success message
            document.querySelector('.payment-details').style.display = 'none';
            document.querySelector('.form-container').style.display = 'none';
            document.getElementById('successMessage').style.display = 'block';
            document.getElementById('transactionId').textContent = transactionId;
            document.getElementById('transactionDate').textContent = transactionDate;

            // Scroll to top
            window.scrollTo(0, 0);
        });

        // Logout
        document.getElementById('logoutBtn').onclick = logout;

        // Initial load
        loadPaymentDetails();
        updateNavigation();
    </script>
</body>
</html>
